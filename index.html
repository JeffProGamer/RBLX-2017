<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ROBLOX 2017 Edition</title>
<style>
body { margin:0; font-family:Arial, sans-serif; background:#f0f4f8; color:#111; }
header { display:flex; align-items:center; background:#fff; padding:10px 20px; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
header img#logo { height:40px; margin-right:10px; cursor:pointer;}
header #userInfo { display:flex; align-items:center; margin-left:10px; }
header #userInfo img { width:32px; height:32px; border-radius:50%; margin-right:6px; }
nav { margin-left:auto; }
nav button { margin-left:10px; padding:6px 12px; cursor:pointer; }
.container { max-width:1100px; margin:20px auto; padding:0 10px; }
.card { background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.05); margin-bottom:15px; }
.games-grid { display:flex; flex-wrap:wrap; gap:10px; }
.game { width:200px; }
.game img { width:100%; border-radius:6px; }
.input{width:100%;padding:10px;margin-bottom:10px;border-radius:6px;border:1px solid #ccc;}
.btn{flex:1;padding:10px;border-radius:6px;border:none;background:#1f8ef1;color:white;cursor:pointer;}
.ghost{flex:1;padding:10px;border-radius:6px;border:1px solid #ccc;background:transparent;cursor:pointer;}
.muted{color:#666;font-size:12px;}
.fullscreen-bg {position:fixed;top:0;left:0;width:100vw;height:100vh;background-size:cover;background-position:center;z-index:-1;}
.search-bar { display:flex; gap:8px; margin-bottom:10px; }
.search-bar input { flex:1; padding:8px; border-radius:6px; border:1px solid #ccc; }
</style>
</head>
<body>
<header>
  <img src="logo.png" id="logo" alt="RLBX Logo"/>
  <strong>ROBLOX 2017 Edition</strong>
  <div id="userInfo"></div>
  <nav>
    <button id="homeBtn">Home</button>
    <button id="gamesBtn">Games</button>
    <button id="signinBtn">Sign In</button>
    <button id="settingsBtn">Settings</button>
    <button id="termsBtn">Terms</button>
    <button id="privacyBtn">Privacy</button>
  </nav>
</header>

<main class="container" id="app"></main>

<script>
const PROXY = "https://rblx-2017.onrender.com"; 
const app = document.getElementById("app");
const userInfo = document.getElementById("userInfo");

// Navigation
document.getElementById("homeBtn").onclick = ()=>navigate("home");
document.getElementById("gamesBtn").onclick = ()=>navigate("games");
document.getElementById("signinBtn").onclick = ()=>navigate("signin");
document.getElementById("settingsBtn").onclick = ()=>navigate("settings");
document.getElementById("termsBtn").onclick = ()=>navigate("terms");
document.getElementById("privacyBtn").onclick = ()=>navigate("privacy");
document.getElementById("logo").onclick = ()=>navigate("home");

function navigate(page){ renderPage(page); }

// Load logged-in user
async function loadUser() {
  try {
    const res = await fetch(`${PROXY}/api/me`, { credentials: 'include' });
    if (!res.ok) return;
    const user = await res.json();
    userInfo.innerHTML = `
      <img src="${user.headshot}" alt="${user.name}">
      <span>${user.name}</span>
      <button id="logoutBtn" style="margin-left:8px;padding:4px 8px;border:none;border-radius:6px;background:#f44336;color:white;cursor:pointer;">Logout</button>
    `;
    document.getElementById("signinBtn").style.display = "none";
    document.getElementById("logoutBtn").onclick = async () => {
      await fetch(`${PROXY}/auth/logout`, { credentials: 'include' });
      userInfo.innerHTML = "";
      document.getElementById("signinBtn").style.display = "inline-block";
      navigate("home");
    };
  } catch(e){ console.log("User not signed in"); }
}

// Render pages
async function renderPage(page){
  app.innerHTML = "";
  if(page==="home"){
    const el = document.createElement("div");
    el.className="card";
    el.innerHTML = "<h2>Welcome to RLBX 2017 Edition</h2><p>Click Games to browse Roblox games.</p>";
    app.appendChild(el);

  } else if(page==="signin"){
    const el = document.createElement('div');
    el.innerHTML = `
      <div class="fullscreen-bg" style="background-image:url('signin.png')"></div>
      <div style="position:relative; max-width:400px; margin:15vh auto; background:rgba(255,255,255,0.95); padding:20px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.1);">
        <h1>Sign In</h1>
        <form class="signin" onsubmit="return false;">
          <button class="btn" onclick="window.location.href=PROXY+'/auth'">Sign in with Roblox</button>
          <button class="ghost" onclick="navigate('home')">Cancel</button>
          <div class="muted" style="margin-top:8px">OAuth handled via server.</div>
        </form>
      </div>
    `;
    app.appendChild(el);

  } else if(page==="games"){
    const el = document.createElement("div");
    el.className="card";
    el.innerHTML = `
      <h2>Games</h2>
      <div class="search-bar">
        <input type="text" id="gameSearch" placeholder="Search games...">
        <button class="btn" id="searchBtn">Search</button>
      </div>
      <div class='games-grid' id='gamesGrid'></div>
    `;
    app.appendChild(el);

    async function loadGames(query='') {
      const grid = document.getElementById("gamesGrid");
      grid.innerHTML = "Loading...";
      try {
        const res = await fetch(`${PROXY}/api/games?query=${encodeURIComponent(query)}&limit=50&page=1`, { credentials:'include' });
        const data = await res.json();
        grid.innerHTML = '';
        if(!data.data.length) grid.innerHTML = '<p>No games found.</p>';
        data.data.forEach(g=>{
          const div = document.createElement("div");
          div.className="game";
          div.innerHTML = `
            <img src="${g.thumbnail||''}" alt="${g.name}">
            <strong>${g.name}</strong>
            <div>${g.creator}</div>
            <a href="https://www.roblox.com/games/${g.id}" target="_blank" class="btn">Play</a>
          `;
          grid.appendChild(div);
        });
      } catch(e){ grid.innerHTML='<p>Error loading games.</p>'; console.error(e); }
    }

    loadGames();

    document.getElementById("searchBtn").onclick = ()=> {
      const q = document.getElementById("gameSearch").value.trim();
      loadGames(q);
    };
  } else if(page==="settings"){
    const el = document.createElement("div");
    el.className="card";
    el.innerHTML = `
      <h2>Settings</h2>
      <form onsubmit="return false;">
        <label>Dark Mode: <input type="checkbox" id="darkModeToggle"></label><br><br>
        <button class="btn" onclick="alert('Settings saved (demo)')">Save</button>
      </form>
    `;
    app.appendChild(el);
    document.getElementById("darkModeToggle").onchange = function(){
      document.body.style.background = this.checked ? "#111" : "#f0f4f8";
    }
  } else if(page==="terms"){
    const el = document.createElement("div");
    el.className="card";
    el.innerHTML = `<h2>Terms of Service</h2><p>Insert your terms here...</p>`;
    app.appendChild(el);
  } else if(page==="privacy"){
    const el = document.createElement("div");
    el.className="card";
    el.innerHTML = `<h2>Privacy Policy</h2><p>Insert your privacy policy here...</p>`;
    app.appendChild(el);
  }
}

// Initial load
navigate("home");
loadUser();
</script>
</body>
</html>
